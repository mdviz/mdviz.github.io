<!DOCTYPE html>
<meta charset="utf-8">
<head>
    <!-- Add Libraries -->
    <script src="libs/d3/d3.min.js" charset="utf-8"></script>
    <script src="libs/jquery/jquery-2.1.1.min.js" charset="utf-8"></script>
    <script src="libs/bootstrap/js/bootstrap.min.js" charset="utf-8"></script>
    <script src="libs/queue/queue.min.js"></script>
    <!--<script src="http://d3js.org/queue.v1.min.js"></script>-->

    <script src="libs/topojson-master/topojson.js"></script>
    <script src="libs/leaflet-0.7.3/leaflet.js"></script>
    <script src="packages/simple_statistics.js"></script>
    <script src="libs/jquery/jquery-ui.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


    <!-- My Tools -->
    <script src="js/chloroClass.js"></script>

    <!-- LEAFLET DATA -->
    <script src="data/transitLines.js"></script>
    <script src="data/dta100V.js"></script>
    <script src="data/rawTazClip.js"></script>
    <script src="data/water/slrp_6ft.js"></script>
    <script src="data/water/slrp_5ft.js"></script>
    <script src="data/water/slrp_4ft.js"></script>
    <script src="data/water/slrp_3ft.js"></script>
    <script src="data/water/slrp_2ft.js"></script>
    <script src="data/water/slrp_1ft.js"></script>
    <script src="data/assets/roads.js"></script>
    <script src="data/assets/exitsPT.js"></script>
    <script src="data/assets/busStops.js"></script>
    <script src="data/assets/mbtaArc.js"></script>
    <script src="data/assets/mbtaNodes.js"></script>
    <script src="data/assets/busLines.js"></script>


    <!-- Viz Elements -->
    <script src="js/ColorScales.js"></script>
    <script src="js/Laccess.js"></script>
    <script src="js/topoMap.js"></script>
    <script src="js/streetMap.js"></script>
    <script src="js/assets.js"></script>
    <script src="js/chart.js"></script>
    <script src="js/groupedChart.js"></script>
    <script src="js/spider.js"></script>
    <script src="js/LineCharts.js"></script>

    <!--<meta name="viewport" content="width=device-width, initial-scale=1.0">-->
    <link rel="stylesheet" type="text/css" href="libs/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="libs/leaflet-0.7.3/leaflet.css"/>
    <link rel="stylesheet" type="text/css" href="css/mycss.css">
    <link rel="stylesheet" type="text/css" href="css/sidebar.css">

    <script>
        $(window).load(function() {
            // Animate loader off screen
            $(".se-pre-con").fadeOut("slow");
        });

        $(document).ready(function(){

            $('ul.tabs li').click(function(){
                var tab_id = $(this).attr('data-tab');

                $('ul.tabs li').removeClass('current');
                $('.tab-content').removeClass('current');

                $(this).addClass('current');
                $("#"+tab_id).addClass('current');
            });

            $("#menu-toggle").click(function(e) {
                console.log("fired");
                e.preventDefault();
                $("#wrapper").toggleClass("toggled");
            });
        });

    </script>
</head>

<body>
<div id="wrapper" class="toggled">
    <!--BLUR ON LOAD-->


    <!--************  THE SIDEBAR ************-->
    <div id="sidebar-wrapper">
        <ul class="sidebar-nav">
            <li class="sidebar-brand">
                <a href="#">Menu</a>
            </li>
            <li>
                <a href="#assetMaster">Inundated Assets</a>
            </li>
            <li>
                <a href="#ridershipChange">Transit Ridership Change</a>
            </li>
            <li>
                <a href="#AccessSelection">Accessibility Impacts</a>
            </li>
            <li>
                <a href="#lostTrips">Lost Trips</a>
            </li>
            <li>
                <a href="#autoNet">Auto Network</a>
            </li>
            <li>
                <a href="docs/DowdProcessBook.pdf" target="_blank">Process Book</a>
            </li>
            <li>
                <a href="http://youtu.be/IjDiOB4HjBk" target="_blank" >Use Video</a>
            </li>
        </ul>
    </div>

    <!--************ BUTTON FOR SIDEBAR ************-->
    <div class="col-md-12" style="position: fixed; height: 100px;">
        <p>
            <a href="#menu-toggle" class="btn btn-default" id="menu-toggle" style="margin-right: 50px">&#9776</a>
        </p>
    </div>

    <!--************ EVERYTHING THE SIDEBAR ************-->
    <div class="se-pre-con">Loading</div>

    <div id="allButMenu">
    <!--IN HERE IS WHERE THE VIZS LIVE-->

        <!--************ INUNDATED ASSETS ************-->
        <div class="row clearfix" id="assetMaster">
            <div class="col-md-12 column" id = "Bar">





                <h1>Visualizing Inundation Impacts on Transportation Networks</h1>
                <p>
                    A major source of uncertainty for many cities and regions throughout the world is the potential impacts of climate change. These impacts include, but are not limited to, extreme weather events, changes in global temperature, droughts, and sea level rise. Of these many potential impacts, sea level rise is perhaps the most relevant to transportation systems: higher sea levels coupled with extreme weather hold the potential to inundate transportation networks and impact the people that live, work and travel to these areas.
                </p>
                    <p>
                        My thesis research focuses on modeling inundation impacts on transportation networks in the Boston Metro Region. The data for the "Inundated Assets" visualization is derived from GIS analysis in ArcMap.
                        All other charts have data derived from the MIT - <a href="http://citilabs.com/software/products/cube/cube-voyager" target="_blank">Cube Voyager</a>  Four Step Transportation Model. Four step models are used to estimate the travel patterns in a region. The output of these models includes
                        origin destination matrices by different modes, as well as network (Transit & Highway) attributes that describe the performance of the network given the number of users in the system. For more information
                        on four step models please see the <a href="http://en.wikipedia.org/wiki/Transportation_forecasting#Four-step_models" target="_blank">basic description</a>. For a more detailed description of methods and models please see this <a href="http://ntl.bts.gov/lib/21000/21500/21563/PB99126724.pdf" target="_blank">source</a> or contact <a href="mailto:mikdowd@gmail.com">Michael Dowd</a>.

                    </p>
                <h4><strong>Assumptions</strong></h4>
                <p>
                    When modeling inundation in the Cube model system, I assume that all users of the sytem will attempt to complete their trip even if portions of the region are inundated.
                    I am modeling a normal day where the transport network is compromised but people still attempt to complete their normal trips, if possible.
                </p>
                <h4><em>For information on using and interpreting this visualization please reference the</em> <a href="http://youtu.be/IjDiOB4HjBk" target="_blank">Use Video.</a></h4>
                <h2>Inundated Assets</h2>
                    <div class="btn-group-horizontal btn-group" id = "AssetSelection">
                        <div class="Btype slider">
                            <span class = "min"></span><input id="AssetSlider" type="range" min=0 max=6 step=1 value=0 oninput="showValue(value,'Asset')"><span class="max"></span>
                            <span>Inundation Level :&nbsp;</span>
                            <span id="Assetrange">0ft</span>
                        </div>
                        <button type="button" class="btn btn-default AssetSelect" id = "AssetDM">Demographics</button>
                        <div class="btn-group-vertical">
                            <button type="button" class="btn btn-default dropdown-toggle AssetSelect"
                                    data-toggle="dropdown" id="AssetHW">Highway<span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu AssetSelect" >
                                <li><a href="#">Roads</a></li>
                                <li><a href="#">Highway Exits</a></li>
                            </ul>
                        </div>
                        <div class="btn-group-vertical">
                            <button type="button" class="AssetSelect btn btn-default dropdown-toggle"
                                    data-toggle="dropdown" id="AssetTR">Transit<span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu AssetSelect">
                                <li><a href="#">Bus</a></li>
                                <li><a href="#">The-T</a></li>
                            </ul>
                         </div>
                        <button type="button" class="btn btn-default waterSelect" value = 0 id = "assetWater">Water</button>
                        <button type="button" class="btn btn-default fillerButton"></button>
                        <button type="button" class="btn btn-default " data-toggle="modal" data-target="#assetModal">?</button>
                     </div>
                 </div>
            </div>
        <!--These are the Tabs-->
        <div class = "row clearfix">
            <div class="col-lg-6"><div id="map3"></div></div>

            <div class="col-lg-6">
                <div class="tabContainer">
                    <ul class="tabs">
                        <li class="tab-link-current" data-tab="tab-2">Charts</li>
                        <li class="tab-link" data-tab="tab-3">Specifics</li>
                    </ul>

                    <div id="tab-2" class="tab-content current">
                        <p><strong>Click Chart to View Different Asset &nbsp;&nbsp;&nbsp; </strong>
                            <button type="button" class="Normal btn btn-default dropdown-toggle" onclick="normalCharts()"> Normalize
                        </button> </p>
                        <div class="col-md-6 column">
                            <div class = "charts" id = "chart"></div>
                            </div>
                        <div class="col-md-6 column">
                            <div class = "charts" id = "chart1"></div>
                        </div>
                        <div class="col-md-6 column">
                            <div class = "charts" id = "chart2"></div>
                        </div>
                        <div class="col-md-6 column">
                            <div class = "charts" id = "chart3"></div>
                        </div>
                    </div>

                    <div id="tab-3" class="tab-content">
                        <!--<p>Mauris eleifend est et turpis. Duis id erat. Suspendisse potenti. Aliquam vulputate, pede vel vehicula accumsan, mi neque rutrum erat, eu congue orci lorem eget lorem. Vestibulum non ante. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Fusce sodales. Quisque eu urna vel enim commodo pellentesque. Praesent eu risus hendrerit ligula tempus pretium. Curabitur lorem enim, pretium nec, feugiat nec, luctus a, lacus.</p>-->
                        <!--<p>Duis cursus. Maecenas ligula eros, blandit nec, pharetra at, semper at, magna. Nullam ac lacus. Nulla facilisi. Praesent viverra justo vitae neque. Praesent blandit adipiscing velit. Suspendisse potenti. Donec mattis, pede vel pharetra blandit, magna ligula faucibus eros, id euismod lacus dolor eget odio. Nam scelerisque. Donec non libero sed nulla mattis commodo. Ut sagittis. Donec nisi lectus, feugiat porttitor, tempor ac, tempor vitae, pede. Aenean vehicula velit eu tellus interdum rutrum. Maecenas commodo. Pellentesque nec elit. Fusce in lacus. Vivamus a libero vitae lectus hendrerit hendrerit.</p>-->
                        <p><strong>Click to see Percentages &nbsp;&nbsp;&nbsp; </strong>
                            <button type="button" class="Normal btn btn-default dropdown-toggle" id="spNormal" value = 0 onclick="normalSpecial()"> Normalize
                            </button> </p>
                        <div id = "context"></div>
                    </div>
                </div>
            </div>
        </div>

        <!--*************************** TRANSIT RIDERSHIP CHANGE ***************************-->
        <div class="row clearfix" id="ridershipChange">
            <div class="col-md-12 column">
                <h2>Transit Ridership Change Given 4ft of Inundation</h2>
                <div class="btn-group-horizontal btn-group" id = "TransitSelection">
                    <button type="button" class="btn btn-default  Ttype">Reset</button>
                    <button type="button" class="btn btn-default  Ttype">View Water</button>
                    <button type="button" class="btn btn-default searchType Ttype" id = "RI">Ridership Increase</button>
                    <button type="button" class="btn btn-default searchType Ttype" id = "RD">Ridership Decrease</button>
                    <button type="button" class="btn btn-default fillerButton"></button>
                    <button type="button" class="btn btn-default " data-toggle="modal" data-target="#transitRidershipModal">?</button>

                </div>
            </div>
        </div>

        <div class="row clearfix">
            <div class="col-md-6 column">
                <div id="map"></div>
            </div>
            <div class="col-md-6 column">
                <!--Top-->
                <div id = "masterHead"></div>
                <!--Holds the Transit Trip Selection Table-->

                <div id="DataSelection">
                </div>

                <div id="RoutesAtStop" style = "margin-left: 10px;margin-bottom:30px;border-bottom: 1px solid #000000">
                    <!--Holds the Transit Trip Selection Table-->
                </div>
            </div>
        </div>
        <!--*************************** ACCESSIBILITY CHANGE ***************************-->
        <div class="row clearfix">
            <div class="col-md-12 column intro" >
                <!--<p>-->
                   <!--aecenas eget feugiat justo. Nullam eros erat, suscipit sed turpis ut, tempus pharetra orci. Suspendisse tincidunt nisl a vehicula fermentum. Mauris bibendum orci dictum placerat vulputate. Fusce ut velit pulvinar, sagittis ex ac, convallis lorem. Duis purus felis, venenatis tristique sollicitudin et, aliquam eget est. Donec egestas odio quis ligula pulvinar, id finibus est sodales. Integer eu semper leo. Maecenas eu lorem vel nunc dapibus ullamcorper. Etiam semper, eros ut ultricies maximus, felis metus aliquam libero, ac efficitur massa sapien eu urna. Nullam vehicula quis tellus tincidunt malesuada. Nulla pulvinar tempus mauris, mollis varius nisl blandit pulvinar. Praesent et porta odio. Sed sit amet volutpat lacus, et hendrerit lorem. Etiam non vestibulum nisl.-->
                <!--</p>-->

            </div>

            <div class="col-md-12 column">
                <div class="btn-group-horizontal btn-group" id = "AccessSelection">
                    <h2>Accessibility To Jobs</h2>
                    <div class="Btype slider">
                        <span></span><input id="AccessSlider" type="range" min=0 max=6 step=1 value=0 oninput="showValue(value, 'Access')"><span></span>
                        <span>Inundation Level :&nbsp;</span>
                        <span id="Accessrange">0ft</span>
                    </div>

                    <button type="button" class="btn btn-default  Atype"  id = "AccessA">Auto</button>
                    <button type="button" class="btn btn-default  Atype" id = "AccessT">Transit</button>
                    <button type="button" class="btn btn-default Atype" id = "AccessW">Walk</button>
                    <button type="button" class="btn btn-default fillerButton"></button>
                    <button type="button" id ="CM" class="btn btn-default accessMethod Atype">Cutoff Measure</button>
                    <button type="button" id ="GM" class="btn btn-default accessMethod Atype">Gamma Measure</button>
                    <button type="button" class="btn btn-default fillerButton"></button>
                    <button type="button" class="btn btn-default "  data-toggle="modal" data-target="#accessModal">?</button>


                </div>

            </div>
                <!--Accessibility Map-->
                <div class="col-md-6 column">
                    <!--Top-->
                    <div class="DataSelection" id = Access_DS>
                        <!--<p>   Etiam ex nulla, sollicitudin vel laoreet in, finibus eu nunc. Vestibulum justo felis, dapibus id justo non, aliquam ullamcorper nulla. Pellentesque id posuere dolor. Sed id orci dignissim, aliquet tortor mattis, egestas eros. Interdum et malesuada fames ac ante ipsum primis in faucibus. Integer lobortis, orci at posuere scelerisque, tellus lectus hendrerit leo, non pulvinar lectus nisl at mauris. Cras cursus, nibh et iaculis dignissim, ante neque iaculis turpis, vitae auctor mi turpis id odio. Interdum et malesuada fames ac ante ipsum primis in faucibus.-->
                            <!--Etiam ex nulla, sollicitudin vel laoreet in, finibus eu nunc. Vestibulum justo felis, dapibus id justo non, aliquam ullamcorper nulla. Pellentesque id posuere dolor. Sed id orci dignissim, aliquet tortor mattis, egestas eros. Interdum et malesuada fames ac ante ipsum primis in faucibus. Integer lobortis, orci at posuere scelerisque, tellus lectus hendrerit leo, non pulvinar lectus nisl at mauris. Cras cursus, nibh et iaculis dignissim, ante neque iaculis turpis, vitae auctor mi turpis id odio. Interdum et malesuada fames ac ante ipsum primis in faucibus.-->


                        <!--</p>-->
                    </div>

                    <div id = "accessHist">
                        <div>


                        </div>
                    </div>
                </div>

                <div class="col-md-6 column">
                    <div id="map2"></div>
                </div>




            <!--Spider Map-->

        </div>

        <!--*************************** LOST TRIPS CHANGE ***************************-->
        <div class =  "row clearfix" id="lostTrips">
            <div class="col-md-12 column intro" >
                <h1>Lost Trips</h1>
            </div>
            <div class="col-md-12 column">
                <div class="btn-group-horizontal btn-group" id = "SpiderSelection" class = "containerGroup">
                    <div class="Btype slider">
                        <span></span><input id="LostSlider" type="range" min=1 max=6 step=1 value=1 oninput="showValue(value, 'Lost')"><span></span>
                        <span>Inundation Level :&nbsp;</span>
                        <span id="Lostrange">1ft</span>
                    </div>
                    <button type="button" class="btn btn-default  Stype" id = "spAuto">Auto</button>
                    <button type="button" class="btn btn-default  Stype" id = "spTransit">Transit</button>
                    <button type="button" class="btn btn-default Stype" id  = "spTotal">Total</button>
                    <button type="button" class="btn btn-default fillerButton"></button>
                    <button type="button" class="btn btn-default " data-toggle="modal" data-target="#lostTripsModal">?</button>

                </div>
            </div>
            <!--Spider Map-->
            <div class="col-md-6 column">
                <div id="spiderHist"></div>
                <div id = "totalLost"></div>
            </div>
            <div class="col-md-6 column">
                <div id="map4"></div>
            </div>
        </div>

        <!--*************************** TRAFFIC MAP CHANGE ***************************-->
        <div class =  "row clearfix" id = "autoNet">

            <div class="col-md-12 column intro" >
                <h1>Auto Network Impacts</h1>
                <h5 style="color:red;">Please Click on Slider Circle Icon and Use Arrow Keys to Switch Between Inundation Levels</h5>
                <div class="btn-group-horizontal btn-group" id = "NetSelection">
                    <div class="Btype slider">
                        <span></span><input id="netSlider" type="range" min=0 max=6 step=1 value=0 oninput="showValue(value, 'Net')"><span id="netSpan"></span>
                        <span>Inundation Level :&nbsp;</span>
                        <span id="Netrange">0ft</span>
                    </div>
                    <button type="button" class="btn btn-default netType" id = "netV" value = "V">Volumes</button>
                    <button type="button" class="btn btn-default netType" id = "netq" value = "q">Queues</button>
                    <!--<button type="button" class="btn btn-default fillerButton"></button>-->
                    <!--<button type="button" class="btn btn-default " id = "netPlay" >Play</button>-->
                    <!--<button type="button" class="btn btn-default " id = "netReset" >Reset</button>-->
                    <button type="button" class="btn btn-default fillerButton"></button>
                    <button type="button" class="btn btn-default " data-toggle="modal" data-target="#autoNetModal">?</button>

                </div>
            </div>

            <!--Traffic Volumes Map-->
            <div class="col-md-12 column">
                <!--Top-->

                <div id="map5"></div>

        </div>
        <!--END ALL BUT THE MENU-->
    </div>

    <!--*****************************************-->
    <!--******************MODALS****************-->
    <!-- Inundated Assets Modal -->
            <div class="modal fade" id="assetModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title" id="assetModalLabel">Inundated Assets</h4>
                        </div>
                        <div class="modal-body">
                            <p>
                                This visualization shows different assets (Jobs, Transit Stations, Roads, etc.) that are impacted by flooding. The data is derived from GIS intersection analyses.
                                Jobs, Population and Household data were only available at a zonal level; therefore, impacts were determined using a proportional split procedure where the proportion of
                                inundated area in a zone was used to determine the proportion of impacted assets in that zone. All other data was available as point data that had specific X & Y coordinates.
                                These data sources were directly intersected with the different water layers to determine if they were potentially impacted.

                            </p>
                            <h3>Use:</h3>
                            <ul>
                                <li>The buttons trigger different data sources and corresponding graphs. The main data sources are Demographics, Transit and Auto.</li>
                                <li>The Water button toggles on and off the water layers. </li>
                                <li>The slider bar transitions the data for the different inundation levels. </li>
                                <li>There are two tabs to the right of the main map: Charts & Specifics
                                    <ul>
                                        <li>“Charts” contains small charts showing the changing impact over the different inundation levels</li>
                                        <li>“Specifics” contains a grouped bar chart highlighting a specific detail of the data related to either Demographics, Highway, or Transit</li>
                                    </ul>

                                </li>
                                <li>All data can be normalized by pressing the Normalize button.</li>

                            </ul>
                            <h3>Main Findings</h3>
                            <ul>
                                <li>By examining the grouped chart under the specifics tab in the Demographics data we see that the percentage impact of inundation on service jobs is very high. Service jobs are arguably the most important sector to the economy and are growing faster than retail and basic jobs This highlights that flooding has the potential to cause major economic impacts on the city of Boston just from an employment perspective.
                                </li>
                                <li>In terms of Transit, the Red Line and Blue Line see major impacts under inundation levels four feet and higher. We can expect many transit users will be unable to reach a destination if inundation has occurred in the city.</li>
                            </ul>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Transit Ridership Trips Modal -->
            <div class="modal fade" id="transitRidershipModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title" id="myModalLabel">Transit Ridership</h4>
                        </div>
                        <div class="modal-body">
                            <p>
                                This visualization articulates the difference between ridership on transit routes at no inundation versus four feet of inundation. Inundation causes specific routes to be heavily impacted or inoperable in certain regions. The model allows portions of a route to operate even if other portions are inundated. The four-foot inundation level is presented because there are major impacts, though much of the region is still free of inundation. I do not present all six inundation levels because of data size constraints.
                                </p>
                            <p>
                                This visualization allows us to examine possible shifts in ridership due to inundation impacts. A possible question that can be examined with this visualization is "If the Red Line is inundated what other routes might persons use to reach their destination." Such answers could be used to preemptively bolster service on specific bus routes or rail lines.
                            </p>
                            <h3>Use</h3>

                            <h4>The Table</h4>
                            <p>The table contains data on:   </p>
                                <ul>
                                    <li>Each transit route, and its specific mode, present in the model system</li>
                                    <li>Ridership on these routes given no inundation (Base Ridership)</li>
                                    <li>Ridership on these routes given 4ft inundation (4ft Ridership)</li>
                                    <li>Difference in Ridership (4ft Ridership - Base Ridership) </li>
                                    <li>Clicking a route in the table will display the boardings and alightings at stops along that route - as well
                                    as nearby ( 1/2 Mile ) stops that had either <em>Ridership Increases</em> or <em>Ridership Decreases</em>.
                                    </li>
                                </ul>


                            <h4>Ridership Increase</h4>
                            <p>
                                When the “ridership increase” button and a route are selected from the table, the only stops visualized will be those stops along the selected route. Stops within 1/2 mile of the selected route that had increases in ridership will also be highlighted. This allows a user to search for routes that possibly gained ridership because of inundation on another route. (See Red Line).
                            </p>
                            <h4>Ridership Decrease</h4>
                            <p>
                                When the “ridership decrease” button and a route are selected from the table, the only stops visualized will be the stops on the selected route, as well as those stops within 1/2 mile of the selected route that had decreases in ridership. This allows a user to search for routes that may have gained riders in response to other nearby routes being inundated. (See CT2).
                            </p>

                            <h3>Main Findings</h3>
                            <ul>
                                <li>A unique opportunity to see potential shifts in route choice given inundation in the area and on the network is provided.</li>
                                <li>Fixed rail lines see major decreases in ridership that are not accounted for in increases in bus ridership.</li>
                                <li>The transference of riders from the Red Line to bus routes CT2 and 85 is illuminated. This  increase in ridership is likely Red Line users who can no longer reach their destination on that route.</li>

                             </ul>



                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>

        <!-- Accessibility Trips Modal -->
        <div class="modal fade" id="accessModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="lostModalLabel">Accessibility To Jobs</h4>
                    </div>
                    <div class="modal-body">

                        <p>Accessibility metrics attempt to quantify the ability to reach assets (in this case Jobs) from a zone. The simplest accessibility measure is a cutoff measure which communicates the number of jobs a
                            person in a given zone can reach within a certain amount of time. These are also called  <a href="http://wiki.openstreetmap.org/wiki/Isochrone" target="_blank">Isochrones</a>.
                            I have normalized each zone’s accessibility by dividing the number of jobs within each zone accessible within an hour by the total number of jobs in the model region.
                        </p>
                        <p>
                            There are many other accessibility metrics that vary in complexity, I have included a measure that incorporates an impedance function, or a Gamma Measure. This accessibility more heavily weighs
                            jobs that take shorter time to access than those that take a longer time. There is no time cutoff in this measure, though at high travel times the contribution of a zone’s jobs to the total sum of
                            weighted jobs is close to zero. The gamma measure output values can only be interpreted relative to other gamma function values.
                        </p>

                        <h3>Use</h3>
                        <p>The slider will display the accessibility changes over the different inundation levels. One can view the accessibility for Walk, Transit and Auto.
                            The scale for each mode is fixed to facilitate comparison over inundation levels.</p>
                        <p>The Accessibility Histogram is "brushable" and will show only those zones with corresponding values in the map.</p>

                        <h3>Main Findings</h3>
                        <ul>
                            <li>Auto always has the highest accessibility and is much less impacted by inundation because of the dense and redundant road network in the region.</li>
                            <li>Transit and Walk accessibility to jobs is always drastically smaller than Auto accessibility and is concentrated region's inner core.</li>
                            <li>Transit accessibility to jobs is drastically impacted by inundation.</li>

                        </ul>

                        <h3>Accessibility Calculation</h3>

                        <p>$$ \mathbf{Jobs\ Gamma \ Accessibility }$$</p>

                        <p>
                            $$Accessibility_{i} \sum_{j \in Z} \frac{Jobs_i}{\sum_{j \in Z} Jobs_j} * TT_{ij}^{-.503} * e^{-0.078 * TT_{ij}} $$
                        </p>
                        <p> $$ \text{Where $Z$ = All Zones}$$</p>

                        <br>
                        <p>$$ \mathbf{ Jobs\ Cutoff\ Accessibility}$$</p>
                        <p>
                            $$Accessibility_{i} =  \frac{\sum_{j \in Z} Jobs_j*TT_{ij}}{\sum_{j \in Z} Jobs_j} $$
                        </p>
                        <p>$$ TT_{ij} =
                            \begin{cases}
                            1,  & \text{if $ TT_{ij}$ is $\leq$ 60 Minutes} \\[2ex]
                            0, & \text{if $ TT_{ij}$ is $>$ 60 Minutes}
                            \end{cases}$$</p>

                        <br>
                        <p> $$ \text{Where $TT_{IJ} = $ Travel Time Between Zone $I$ and Zone $J$ }$$</p>
                        <p> $$ \text{Where $Z$ = All Zones}$$</p>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Lost Trips Modal -->
        <div class="modal fade" id="lostTripsModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">Lost Trips</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            Many trips can no longer be completed given inundation of the road and transit networks.
                            This visualization shows those origin and destination pairs that lost the most trips. I used
                            a cutoff value of 50 trips to prune the dataset down. The direction of flow is collapsed, as well,
                            to reduce the size of the data. This means that trips lost between zones O & D are grouped with trips
                            lost between zones D & O. If the total lost trips between a given Origin and Destination was less than
                            50 then a line is not drawn. The thickness of the lines indicates the number of lost trips. Furthermore,
                            they are redundantly encoded by color to make them visually clear. This type of visualization is commonly
                            called a <a href="http://www.fhwa.dot.gov/planning/census_issues/ctpp/training/flow.cfm" target="_blank">"Desire Line"</a>
                            map and is typically generated in proprietary transport modeling software packages.
                        </p>
                        <h3>Use</h3>
                        <p>Click the Buttons to change between Transit, Auto, Total. </p>
                        <p>Total is just the sum of Transit and Auto.</p>
                        <p>The Lost Trips Histogram is "brushable" and linked to the map. When brushed only those brushed values will appear in the map.</p>
                        <p>The <em>Total Percent of Lost Trips</em> is included for reference. About 16.4 Million total number of trips occur in one day in the model region.</p>
                    <h3>Main Findings:</h3>
                        <ul>
                            <li>The greatest number of lost auto trips occur north of the inner core. Though the total number summed by the inner core is likely larger, it is key to note that because the trips are split up into many different zones and zones are smaller in the inner core the values can appear smaller.</li>
                            <li>Transit Lost trips are far fewer but very concentrated in the inner core.
                            </li>
                            <li>Lost trips occur where inundation occurs (reference inundated assets map)</li>
                        </ul>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Auto Network  Modal -->
        <div class="modal fade" id="autoNetModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">Auto Network Volumes & Queues</h4>
                    </div>
                    <div class="modal-body">
                        <p>This visualization shows the modeled highway volumes and queues of vehicles across the six different inundation levels. </p>

                        <h3>Volumes</h3>
                        <p>Modeled auto on volumes each link. The unit of measurement is vehicles per link.</p>
                        <h3>Queues</h3>
                        <p>Queuing vehicles are those vehicles that can pass through a given link because of congestion on the highway network.
                            Areas of high queues would be areas that are heavily congested (i.e. standstill traffic).</p>

                        <h3>Main Findings:</h3>
                        <ul>
                            <li>As inundation increases volumes move to outer ring roads (MA Route 128 & HWY 95 & HWY 93)</li>
                            <li>As inundation increases queues move toward these outer ring roads as well, though there are other links
                                that become heavily congested in the inner core area.
                                These links are likely congested because other alternative links are inundated.
                            </li>
                            <li>At six feet of inundation there is much less congestion in the network because there are far fewer vehicles in the network overall</li>
                        </ul>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>


    </div>
</div>
</body>

<script>
    var test;
    var data;
    var access;
    var dta;
    var waterLayer = null;
    var lookUp ={};
    var info = L.control();



    //Load Data for lookup Table used to clean up Transit Route Names
    d3.json("data/relabelTransit.json", function(data){
        data.forEach(function(d){
            lookUp[d.Raw] = d.CleanName
        })
    });

    var water = {
        "water1": water1,
        "water2": water2,
        "water3": water3,
        "water4": water4,
        "water5": water5,
        "water6": water6
    };

    var Demographics = {
        "jobs": null,
        "households":null,
        "pop" : null,
        "firms":null,
        "gjobs": null,
        "groads":null,
        "gtlines":null
    };

    var accessUnits = {
      "method": "c",
      "mode": "auto",
      "auto": null,
      "transit" : null,
      "walk":null,
      "gauto":null,
      "gtransit": null,
      "gwalk" : null
    };

    var nets = {
        "n0" : null,
        "n1" : null,
        "n2" : null,
        "n3" : null,
        "n4" : null,
        "n5" : null,
        "n6" : null
    };



    function testing(error, d2,d3){
        console.log("TESTING", d2,d3)
    }

    queue()
            .defer(d3.json, "data/TazClip.json")
            .defer(d3.json, "data/assets/jobs1.json")
            .defer(d3.json, "data/assets/hh.json")
            .defer(d3.json, "data/assets/pop.json")
            .defer(d3.json, "data/assets/firms2.json")
            .defer(d3.csv, "data/access_JOBS/autoJobs.csv")
            .defer(d3.csv, "data/access_JOBS/transitJobs.csv")
            .defer(d3.csv, "data/access_JOBS/walkJobs.csv")
            .defer(d3.csv, "data/access_JOBS/gautoJobs.csv")
            .defer(d3.csv, "data/access_JOBS/gtransitJobs.csv")
            .defer(d3.csv, "data/access_JOBS/gwalkJobs.csv")
            .defer(d3.csv, "data/assets/groupJobs.csv")
            .defer(d3.json, "data/dtaTopo0ft.json")
            .defer(d3.csv, "data/assets/groupRoads.csv")
            .defer(d3.csv, "data/assets/groupTransitLines.csv")
            .await(ready);


    var styles = {
        "waterStyle": function waterStyle(feature){
                            return {weight: 1, color: "#000033", clickable:false}
            },
        "setTransitWeight": function setTransitWeight(mode){
            return (mode === 1) || (mode === 2) ? 1 :
                    (mode === 3) || (mode === 4) ? 7:
                            (mode === 5) ? 3: 7},
        "setTransitColor": function setTransitColor(mode, name){
            if (name.toLowerCase()){
                name = name.toLowerCase();
                    if ((mode === 1) || (mode === 2)){
                        return "yellow"
                    }   else if (mode === 5){
                        return "gray"
                    }
                    else if (name.indexOf("red") > -1){
                            return "#E22322"
                    }
                    else if (name.indexOf("green") > -1){
                        return "#018445"
                    }
                    else if (name.indexOf("blue") > -1) {
                        return "#007AC2"
                    }
                    else if (name.indexOf("orange") > -1) {
                        return "#F3891D"
                    }
                }
                else {return null}
            },
        "transitStyle": function transitStyle(feature) {
                return {
                    weight: styles.setTransitWeight(feature.properties["MODE"]),
                    color: styles.setTransitColor(feature.properties["MODE"], feature.properties["NAME"])
                };
        },
        "colorLines" : function colorLines(d) {
            if (d.Mode === 1 || d.Mode === 2) {
                return "#C2C2D6"}
            else if (d.Mode === 5) {
                return "#E6F0F5"
            } else {
                var check = d.Name.trim();
                return check === "Red" ? "#FF6666" : check === "Green" ? "#99D6AD" : check === "Blue" ? "#C2C2F0" :
                        check === "Orange" ? "#FFC266" : "yellow"}
            }

    };

    function ready(error, theTaz, Qjobs, Qhh, Qpop, Qfirms, Qauto, Qtransit, Qwalk, QGauto, QGtransit, QGwalk, Qgrjobs, Qnet0, Qgroads, Qgtlines) {

        console.log("Ready ", theTaz)
        data = theTaz;
        Demographics.jobs = Qjobs;
        Demographics.households = Qhh;
        Demographics.pop = Qpop;
        Demographics.gjobs = Qgrjobs;
        Demographics.firms = Qfirms;
        Demographics.groads = Qgroads;
        Demographics.gtlines = Qgtlines;
        accessUnits.cauto = Qauto;
        accessUnits.ctransit = Qtransit;
        accessUnits.cwalk = Qwalk;
        accessUnits.gauto = QGauto;
        accessUnits.gwalk = QGtransit;
        accessUnits.gtransit = QGwalk;
        access = accessUnits.cauto;
        nets.n0 = Qnet0;

        queue()
                .defer(d3.json, "data/dtaTopo1ft.json")
                .defer(d3.json, "data/dtaTopo2ft.json")
                .defer(d3.json, "data/dtaTopo3ft.json")
                .defer(d3.json, "data/dtaTopo4ft.json")
                .defer(d3.json, "data/dtaTopo5ft.json")
                .defer(d3.json, "data/dtaTopo6ft.json")
                .await(netLoads);

        function netLoads(error,Qn1, Qn2, Qn3,Qn4,Qn5,Qn6 ){
            nets.n1 = Qn1;
            nets.n2 = Qn2;
            nets.n3 = Qn3;
            nets.n4 = Qn4;
            nets.n5 = Qn5;
            nets.n6 = Qn6;
        }

        //Leaflet Base Maps
        map = L.map("map").setView([42.3596, -71.0561], 12);

        L.tileLayer('https://{s}.tiles.mapbox.com/v3/{id}/{z}/{x}/{y}.png', {
            maxZoom: 18,
            minZoom: 11,
            id: 'examples.map-20v6611k'
        }).addTo(map);

        map2 = L.map("map2").setView([42.3596, -71.0561], 10);
        L.tileLayer('https://{s}.tiles.mapbox.com/v3/{id}/{z}/{x}/{y}.png', {
            maxZoom: 18,
            minZoom: 9,
            id: 'examples.map-20v6611k'
        }).addTo(map2);


        map3 = L.map("map3").setView([42.3596, -71.0561], 12);
        L.tileLayer('https://{s}.tiles.mapbox.com/v3/{id}/{z}/{x}/{y}.png', {
            maxZoom: 18,
            minZoom: 9,
            id: 'examples.map-20v6611k'
        }).addTo(map3);

        map4 = L.map("map4").setView([42.3596, -71.0561], 12);
        L.tileLayer('https://{s}.tiles.mapbox.com/v3/{id}/{z}/{x}/{y}.png', {
            maxZoom: 18,
            minZoom: 9,
            id: 'examples.map-20v6611k'
        }).addTo(map4);

        map5 = L.map("map5").setView([42.3596, -71.0561],12);
        L.tileLayer('https://{s}.tiles.mapbox.com/v3/{id}/{z}/{x}/{y}.png', {
            maxZoom: 18,
            minZoom: 9,
            id: 'examples.map-20v6611k'
        }).addTo(map5);

        L.control.scale().addTo(map);
        L.control.scale().addTo(map2);
        L.control.scale().addTo(map3);
        L.control.scale().addTo(map4);
        L.control.scale().addTo(map5);

        //INITIAL MAPS //
        street_viz = new StreetMapVis("map");
        //Access Map Stuff
        assetsGlobals.current = null;
        access = accessUnits.cauto;
        access_viz = new AccessVis(d3.select("#map2"), "Access");
        //Asset Map
        asset_map_viz = new AssetMapVis();
        group_char_viz = new GroupChartVis("#context");
        //Spider Map
        spider_viz = new SpiderViz(map4);
        asset_map_viz.asset_viz5 = new LineVis(d3.select("#totalLost"), assetsGlobals.totalLostTrips, "Total Percent Lost Trips",false,true);
        traffic_map = new NetViz(map5, nets.n0);

        //END READY FUNCTION
    }

    //Slider
    function showValue(value, sliderViz){
        $("#" + sliderViz + "range").html(value+"ft");
        if (sliderViz === "Access"){
            //Need to clear the brush to prevent odd things from occuring
            accessVizGlobals.accessBrush().clear();
            access_viz.showValue(value)
        } else if (sliderViz === "Net" ){
            var val = $("#netSlider").val();
            var data = nets["n"+val];
            traffic_map.updateVis(data, netVizGlobals.attribute)
        } else if (sliderViz === "Asset" ){
            if(asset_map_viz.Assets.selected === "Demographics" )
            {
                if (value === "0"){
                    asset_map_viz.toggleLegend(true);
                    d3.selectAll("rect.assetBar").classed("desaturate", false);
                    map3.removeLayer(asset_map_viz.Features);
                } else {
                    d3.selectAll("rect.assetBar").classed("desaturate", true);
                    d3.selectAll("rect.s" + (value-1) + ".assetBar").classed("desaturate", false);


                    var dim = asset_map_viz.Assets.demoDim === undefined ? "jobs" : asset_map_viz.Assets.demoDim;

                    map3.removeLayer(asset_map_viz.Features);
                    asset_map_viz.wrangleDemData(Demographics[dim.toLocaleLowerCase()], dim.toUpperCase(), +value)
                }

            } else {
                assetsGlobals.highlightSlrFeatures(+value);
            }
            var theMap = sliderViz  === "Asset" ? map3 : sliderViz === "Transit" ? map : sliderViz === "Access" ? map2: null;
            addWater(value, theMap);


        } else if (sliderViz === "Lost") {
            d3.selectAll(".theSpiderLines").remove();
            d3.selectAll(".centroids").remove();
            spider_viz.loaded(spider_viz.taz, spider_viz.spiderData[spider_viz.spiderData.current + value])
            }


    }

    function updateSpecialChart(check){
        $("#spNormal").val(0);
        group_char_viz.transitionVis();
        if (check === "Highway Exits" || check === "Roads") {
            group_char_viz.wrangleData(Demographics.groads, groupCharGlobals.label.Highway)
        } else if (check === "The-T" || check === "Bus") {
            group_char_viz.wrangleData(Demographics.gtlines, groupCharGlobals.label.Transit)
        } else {
            group_char_viz.wrangleData(Demographics.gjobs, groupCharGlobals.label.Demographics)

        }
    }

    $(document).ready(function(){
        //Inundated Assets Buttons
        $(".AssetSelect").on("click", function (e) {

            var check = e.target.innerText;

            if (check !== "Highway" && check !== "Transit") {

                $("#AssetDM").removeClass("selectedButton");
                $("#AssetHW").removeClass("selectedButton");
                $("#AssetTR").removeClass("selectedButton");

                asset_map_viz.toggleLegend(true);
                if (asset_map_viz.Assets.selected !== check){

                    var currentValue = asset_map_viz.Assets.selected;
                    asset_map_viz.Assets.selected = check;
                    removeWater(map3);
                    asset_map_viz.Assets.demoDim = undefined;
                    asset_map_viz.updateAssetInfo();
                }
                if (check === "Highway Exits") {
                    asset_map_viz.updateLayers("exits", "roads");
                    $("#AssetHW").addClass("selectedButton");
                } else if (check === "Bus") {
                    asset_map_viz.updateLayers("busStops","busLines");
                    $("#AssetTR").addClass("selectedButton");
                } else if (check === "Roads") {
                    asset_map_viz.updateLayers("roads");
                    $("#AssetHW").addClass("selectedButton");
                } else if (check === "The-T") {
                    asset_map_viz.updateLayers("T_Stops","T_Lines");
                    $("#AssetTR").addClass("selectedButton");
                }

                if (asset_map_viz.Assets.lookUp[check] !== asset_map_viz.Assets.lookUp[currentValue]) {
                    d3.selectAll(".littleCharts").remove();
                    $("#Assetrange").text("0ft");
                    removeWater(map3);
                    updateSpecialChart(check);

                    if (asset_map_viz.Assets.lookUp[check] === "Highway") {
                        asset_map_viz.asset_viz = new LineVis(d3.select("#chart"), exits, "Highway Exits",true);
                        asset_map_viz.asset_viz2 = new LineVis(d3.select("#chart1"), assetsGlobals.roadTotals, "Roads",false);
                    } else if (check === "Bus" || check === "The-T") {
                        asset_map_viz.asset_viz = new LineVis(d3.select("#chart"), busStops, "Bus Stops", true);
                        asset_map_viz.asset_viz2 = new LineVis(d3.select("#chart1"), T_Stops, "T - Stops",true);
                        asset_map_viz.asset_viz3 = new LineVis(d3.select("#chart2"), assetsGlobals.tLineTotals, "T - Lines Sq.Miles",false);
                        asset_map_viz.asset_viz4 = new LineVis(d3.select("#chart3"), assetsGlobals.busLineTotals, "Bus Lines Sq.Miles",false);
                    } else if (check === "Demographics") {
                        $("#AssetDM").addClass("selectedButton");
                        asset_map_viz.asset_viz = new AssetVis(d3.select("#chart"), Demographics.jobs, "Jobs");
                        asset_map_viz.asset_viz2 = new AssetVis(d3.select("#chart1"), Demographics.pop, "Pop");
                        asset_map_viz.asset_viz3 = new AssetVis(d3.select("#chart2"), Demographics.households, "Households");
                        asset_map_viz.asset_viz4 = new AssetVis(d3.select("#chart3"), Demographics.firms, "Firms");
                        asset_map_viz.wrangleDemData(Demographics.jobs, "JOBS", 0)

                    }
                }
            }
        });
        $(".waterSelect").on("click", function(e){
            var check  = e.target;
            var sliderVal;
            if (check.id === "assetWater") {
                sliderVal= $("#AssetSlider").val();
                assetsGlobals.showWater = !assetsGlobals.showWater;
                if (!assetsGlobals.showWater){
                    $("#assetWater").removeClass("selectedButton");
                    addWater(0,map3)
                }else {
                    addWater(sliderVal,map3);
                    $("#assetWater").addClass("selectedButton");
                }
            }
        });
        //Lost Trip Buttons
        $("#SpiderSelection").on("click", function(e){
            if (e.target !== "range" && ["Auto", "Transit", "Total"].indexOf(e.target.innerText) > -1){
                    //console.log("in the spider button click", e.target.innerText);
                    d3.selectAll(".spiderBar").remove();
                    d3.selectAll(".theSpiderLines").remove();
                    d3.selectAll(".centroids").remove();
                    spider_viz.changeMode(e.target)
                }

        });
        //Road Network Buttons
        $(".netType").on("click", function(e){
            var check = e.target.innerText;
            var value = $("#netSlider").val();
            var data = nets["n"+ value];
            netVizGlobals.attribute = check === "Queues" ? "q" : "V";
            if (netVizGlobals.attribute === "V"){
                $("#netV").addClass("selectedButton");
                $("#netq").removeClass("selectedButton");
            } else{
                $("#netq").addClass("selectedButton");
                $("#netV").removeClass("selectedButton");
            }
            d3.selectAll(".netLegendRect").remove();
            d3.selectAll(".netLegendSVG").remove();
            traffic_map.updateVis(data,netVizGlobals.attribute)
        });
        //Acceessibility Buttons
        $(".Atype").on("click", function(d){
            var that = access_viz;
            if ( d.target.innerText === "Cutoff Measure" || d.target.innerText === "Gamma Measure"){
                if (d.target.innerText === "Cutoff Measure") {
                    $("#CM").addClass("selectedButton");
                    $("#GM").removeClass("selectedButton");
                    accessUnits.method = "c";
                } else if (d.target.innerText === "Gamma Measure") {
                    $("#GM").addClass("selectedButton");
                    $("#CM").removeClass("selectedButton");
                    accessUnits.method = "g";
                }
                access = accessUnits[accessUnits.method + accessUnits.mode];
                that.wrangleData(access,+d3.select("#AccessSlider").property("value") )
            }
            else {
                $("#AccessA").removeClass("selectedButton");
                $("#AccessT").removeClass("selectedButton");
                $("#AccessW").removeClass("selectedButton");

                if (d.target.innerText === "Walk") {
                    $("#AccessW").addClass("selectedButton");
                    access = accessUnits[accessUnits.method+"walk"];}
                if (d.target.innerText === "Auto") {
                    $("#AccessA").addClass("selectedButton");
                    access = accessUnits[accessUnits.method+"auto"];}
                if (d.target.innerText === "Transit") {
                    $("#AccessT").addClass("selectedButton");
                    access = accessUnits[accessUnits.method+"transit"];}



                accessUnits.mode = d.target.innerText.toLowerCase();
                $("#AccessSlider").val(0); //Reset Slider Value to 0
                $("#Accessrange").text("0ft"); //Reset Text to 0ft
                that.wrangleData(access,+d3.select("#AccessSlider").property("value") )
            }
        });
        //Transit RiderShip Buttons
        $('.Ttype').click(function(e){
            var clicked = e.target.innerText.trim();
            if (clicked === "Reset"){
                street_viz.resetVis()
            } else if (e.target.innerText === "View Water"){
                street_viz.toggleWater(!StreetMapGlobals.viewWater);
                StreetMapGlobals.viewWater = !StreetMapGlobals.viewWater;
            } else if (clicked === 'Ridership Increase' || clicked === "Ridership Decrease"){
                if (clicked === "Ridership Increase"){
                    $("#RI").addClass("selectedButton");
                    $("#RD").removeClass("selectedButton");
                } else {
                    $("#RD").addClass("selectedButton");
                    $("#RI").removeClass("selectedButton");
                }

                StreetMapGlobals.gainOrLoss = clicked;
            }
        })
    });

    //Water Layers For Many of the Views
    function addWater(level, theMap){
        if (theMap === map3 && !assetsGlobals.showWater) {
            if (waterLayer !== null)  theMap.removeLayer(waterLayer);
        } else {
        if (level > 0){
            if (waterLayer !== null){
                theMap.removeLayer(waterLayer);
            }
            waterLayer = L.geoJson(water["water"+level], {
                style: styles.waterStyle,
                onEachFeature: null
            }).addTo(theMap);

        } else {
            if (waterLayer !== null)  theMap.removeLayer(waterLayer);
        }
        }
    }

    function removeWater(aMap){
        try {
            aMap.removeLayer(waterLayer);
            $("#AssetSlider").val(0);
        }
        catch(err){}
    }

    function normalSpecial(){
        groupCharGlobals.normal = !groupCharGlobals.normal
        if (groupCharGlobals.normal) {
            d3.select("#groupYlabel").classed("hide", true);  //If normalized then hide axis unti label
        } else {
            d3.select("#groupYlabel").classed("hide", false); //Else show the unit label
        }
        group_char_viz.updateVis(true, groupCharGlobals.normal);
    }

    function normalCharts(){
        asset_map_viz.asset_viz.normalize();
        asset_map_viz.asset_viz2.normalize();
        asset_map_viz.asset_viz3.normalize();
        asset_map_viz.asset_viz4.normalize();
    }



//$("#netPlay").on("click", function(){
//    var vals = [0,1,2,3,4,5,6];
//    var index = 0;
//    var first = true;
//
//    var start = new Date().getTime();
//    function execute() {
//
//        if ((new Date().getTime() - start) > 30000  ){
//            clearInterval(call)
//        }
//
//        console.log("index", index, vals);
//        $("#netSlider").val(index);
//        showValue(vals[index], 'Net');
//        if (index === 6){
//            vals.reverse();
//            index = 5;
//        } if (index===0 && !first){
//            vals.reverse()
//        }
//
//        if (vals[0]===6){
//            index -= 1;
//        } else {
//            index += 1
//        }
//        first = false;
//    }
//
//    var call = setInterval(execute, 2000)
//
//
//
//})$("#netPlay").on("click", function(){
//    var vals = [0,1,2,3,4,5,6];
//    var index = 0;
//    var first = true;
//
//    var start = new Date().getTime();
//    function execute() {
//
//        if ((new Date().getTime() - start) > 30000  ){
//            clearInterval(call)
//        }
//
//        console.log("index", index, vals);
//        $("#netSlider").val(index);
//        showValue(vals[index], 'Net');
//        if (index === 6){
//            vals.reverse();
//            index = 5;
//        } if (index===0 && !first){
//            vals.reverse()
//        }
//
//        if (vals[0]===6){
//            index -= 1;
//        } else {
//            index += 1
//        }
//        first = false;
//    }
//
//    var call = setInterval(execute, 2000)
//
//
//
//})

//    queue()
//            .defer(d3.json, "data/assets/jobsREPO.json")
//            .await(testq);
//
//    function testq(error, thing){
//        var data = thing;
//        console.log("this taz", data)
//    }


</script>